<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V√≤ng Quay L√¨ X√¨ May M·∫Øn</title>

<style>
body{
  font-family: Arial, sans-serif;
  text-align:center;
  background:linear-gradient(#fff5d6,#ffe4a8);
  margin:0;
  padding:0;
  min-height:100vh;
  overflow-x:hidden;
}

h1{
  margin-top:25px;
  font-size:28px;
  color:darkred;
}

canvas{
  margin-top:20px;
  width:90vw;
  max-width:500px;
  height:auto;
}

button{
  margin-top:20px;
  padding:14px 35px;
  font-size:18px;
  background:darkred;
  color:white;
  border:none;
  border-radius:15px;
  cursor:pointer;
}

/* ===== MODAL ===== */

.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.65);
  justify-content:center;
  align-items:center;
  z-index:999;
}

.modal-content{
  background:transparent;
  box-shadow:none;
  padding:0;
  border-radius:0;
  position:relative;
  text-align:center;
}

/* ch·ªØ ti√™u ƒë·ªÅ tr√™n n·ªÅn n√¢u */
.modal h2{
  position:absolute;
  top:40px;
  left:50%;
  transform:translateX(-50%);
  color:#FFD700;
  font-size:28px;
  text-shadow:0 0 10px rgba(0,0,0,0.7);
  z-index:10;
}

.lixiBox{
  position:relative;
  display:inline-block;
}

#lixiImage{
  width:420px;
  max-width:90vw;
  cursor:pointer;
}

#rewardText{
  position:absolute;
  top:150px;
  left:50%;
  transform:translateX(-50%);
  font-size:28px;
  font-weight:bold;
  color:darkred;
  display:none;
  animation:fadeIn 1s ease forwards;
}

@keyframes fadeIn{
  from{opacity:0; transform:translate(-50%,20px);}
  to{opacity:1; transform:translate(-50%,0);}
}

/* n√∫t ƒë√≥ng n·∫±m tr√™n n·ªÅn n√¢u */
#closeBtn{
  position:absolute;
  bottom:40px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 30px;
  font-size:18px;
  border-radius:15px;
  background:darkred;
  color:white;
  cursor:pointer;
  z-index:10;
}

/* üéÜ ph√°o hoa */
.firework{
  position:absolute;
  width:8px;
  height:8px;
  border-radius:50%;
  animation:explode 1s ease-out forwards;
}

@keyframes explode{
  from{transform:scale(0); opacity:1;}
  to{transform:scale(4); opacity:0;}
}
</style>
</head>

<body>

<h1>üé° V√≤ng Quay L√¨ X√¨ May M·∫Øn üéÅ</h1>

<canvas id="wheel"></canvas>
<br>
<button id="spinBtn">üé≤ QUAY NGAY</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h2>üßß M·ªû L√å X√å NH·∫¨N QU√Ä</h2>

    <div class="lixiBox">
      <img id="lixiImage" src="images/lixi.png">
      <div id="rewardText"></div>
      <button id="closeBtn">ƒê√≥ng</button>
    </div>

  </div>
</div>

<script>
const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");

function resizeCanvas(){
  let size=Math.min(window.innerWidth*0.9,500);
  canvas.width=size;
  canvas.height=size;
}
resizeCanvas();
window.addEventListener("resize",()=>{
  resizeCanvas();
  drawWheel();
});

const spinBtn=document.getElementById("spinBtn");
const modal=document.getElementById("modal");
const closeBtn=document.getElementById("closeBtn");
const lixiImage=document.getElementById("lixiImage");
const rewardText=document.getElementById("rewardText");

const prizes=[
 {name:"10K",weight:0},
 {name:"50K",weight:0},
 {name:"100K",weight:0},
 {name:"200K",weight:0},
 {name:"500K",weight:0},
 {name:"‚ù§Ô∏è nh·ªè b√© c·ªßa Ph√∫c",weight:100},
 {name:"1 Tri·ªáu",weight:0}
];

const sliceAngle=(2*Math.PI)/prizes.length;
let angle=0;
let spinning=false;
let finalReward="";

const lixiIcon=new Image();
lixiIcon.src="images/lixi.png";

function drawWheel(){
 let center=canvas.width/2;
 let wheelRadius=canvas.width*0.45;
 let iconRadius=canvas.width*0.22; 
 let iconSize=canvas.width*0.12;

 ctx.clearRect(0,0,canvas.width,canvas.height);

 for(let i=0;i<prizes.length;i++){
   let start=angle+i*sliceAngle;

   ctx.beginPath();
   ctx.moveTo(center,center);
   ctx.arc(center,center,wheelRadius,start,start+sliceAngle);
   ctx.fillStyle="#FFD700";
   ctx.fill();
   ctx.stroke();

   let mid=start+sliceAngle/2;
   let x=center+iconRadius*Math.cos(mid);
   let y=center+iconRadius*Math.sin(mid);

   ctx.save();
   ctx.translate(x,y);
   ctx.rotate(mid+Math.PI/2);
   ctx.drawImage(lixiIcon,-iconSize/2,-iconSize,iconSize,iconSize*1.3);
   ctx.restore();
 }

 ctx.fillStyle="darkred";
 ctx.beginPath();
 ctx.moveTo(center-15,10);
 ctx.lineTo(center+15,10);
 ctx.lineTo(center,60);
 ctx.fill();
}

function getPrize(){
 let total=prizes.reduce((s,p)=>s+p.weight,0);
 let rand=Math.random()*total;
 for(let p of prizes){
   if(rand<p.weight) return p.name;
   rand-=p.weight;
 }
}

function showResult(prize){
 finalReward=prize;
 lixiImage.src="images/lixi.png";
 rewardText.style.display="none";
 modal.style.display="flex";
}

function createFirework(){
 const fw=document.createElement("div");
 fw.className="firework";
 fw.style.background=`hsl(${Math.random()*360},100%,50%)`;
 fw.style.left=Math.random()*100+"%";
 fw.style.top=Math.random()*100+"%";
 document.querySelector(".modal-content").appendChild(fw);
 setTimeout(()=>fw.remove(),1000);
}

lixiImage.onclick=function(){
 lixiImage.src="images/lixi_open.png";
 setTimeout(()=>{ for(let i=0;i<20;i++){ createFirework(); } },500);
 setTimeout(()=>{
   rewardText.innerHTML=finalReward;
   rewardText.style.display="block";
 },1000);
};

spinBtn.onclick=function(){
 if(spinning) return;
 spinning=true;

 let prize=getPrize();
 let spinTime=0;
 let spinTimeTotal=6000;
 let startSpeed=0.25;
 let currentSpeed=startSpeed;

 let userId = localStorage.getItem("userId");
 if(!userId){
   userId = "USER_" + Math.random().toString(36).substring(2,10);
   localStorage.setItem("userId", userId);
 }

 function animate(){
   spinTime+=16;
   let progress=spinTime/spinTimeTotal;
   currentSpeed=startSpeed*(1-progress);
   angle+=currentSpeed;
   drawWheel();

   if(spinTime < spinTimeTotal){
     requestAnimationFrame(animate);
   }else{
     spinning=false;
     showResult(prize);

     fetch("https://script.google.com/macros/s/AKfycbxpico6Qy-vKGHH2LTlxYy-OaY4Kx9FUgGX7maCtnfGDp9B1jYR9RhjyX5BdMfruOc/exec", {
       method: "POST",
       mode: "no-cors",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify({
         userId: userId,
         prize: prize
       })
     });
   }
 }

 animate();
};

closeBtn.onclick=function(){
 modal.style.display="none";
};

lixiIcon.onload=function(){
 drawWheel();
};
</script>

</body>
</html>
