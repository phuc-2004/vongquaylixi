<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>V√≤ng Quay L√¨ X√¨ May M·∫Øn</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial;
      text-align: center;
      background: linear-gradient(#fff5d6, #ffe4a8);
      min-height: 100vh;
    }

    h1 {
      margin: 20px 0;
      font-size: 28px;
      color: darkred;
    }

    canvas {
      display: block;
      margin: auto;
    }

    button {
      margin: 20px auto;
      padding: 14px 35px;
      font-size: 18px;
      background: darkred;
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: white;
      width: 90%;
      max-width: 500px;
      padding: 25px;
      border-radius: 20px;
      text-align: center;
      animation: zoomIn 0.3s ease;
    }

    @keyframes zoomIn {
      from {transform: scale(0.6); opacity: 0;}
      to {transform: scale(1); opacity: 1;}
    }

    #lixiImage {
      width: 220px;
      max-width: 80%;
      cursor: pointer;
      transition: 0.3s;
    }

    #rewardText {
      font-size: 22px;
      font-weight: bold;
      color: darkred;
      margin-top: 15px;
      display: none;
    }

    #rewardText.show {
      display: block;
    }

    #closeBtn {
      margin-top: 15px;
      padding: 10px 30px;
      border-radius: 12px;
      border: none;
      background: darkred;
      color: white;
      cursor: pointer;
    }

    /* PH√ÅO HOA */
    #fireworks {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .firework {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: boom 0.8s ease-out forwards;
    }

    @keyframes boom {
      from {transform: scale(0.2); opacity: 1;}
      to {transform: translate(var(--x), var(--y)) scale(1.3); opacity: 0;}
    }
  </style>
</head>

<body>

  <h1>üé° V√≤ng Quay L√¨ X√¨ May M·∫Øn üéÅ</h1>

  <canvas id="wheel"></canvas>

  <button id="spinBtn">üé≤ QUAY NGAY</button>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h2>üßß M·ªû L√å X√å NH·∫¨N QU√Ä</h2>

      <img id="lixiImage" src="images/lixi.png">
      <div id="rewardText"></div>
      <div id="fireworks"></div>

      <button id="closeBtn">ƒê√≥ng</button>
    </div>
  </div>

<script>
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");

  const spinBtn = document.getElementById("spinBtn");
  const modal = document.getElementById("modal");
  const closeBtn = document.getElementById("closeBtn");

  const lixiImage = document.getElementById("lixiImage");
  const rewardText = document.getElementById("rewardText");

  const prizes = [
    { name: "10K", weight: 0 },
    { name: "50K", weight: 0 },
    { name: "100K", weight: 0 },
    { name: "200K", weight: 0 },
    { name: "500K", weight: 0 },
    { name: "‚ù§Ô∏è nh·ªè b√© c·ªßa Ph√∫c", weight: 100 },
    { name: "1 Tri·ªáu", weight: 0 }
  ];

  let angle = 0;
  let spinning = false;
  let finalReward = "";

  const lixiIcon = new Image();
  lixiIcon.src = "images/lixi.png";

  /* ‚úÖ RESIZE CANVAS CHU·∫®N MOBILE */
  function resizeCanvas() {
    let size = Math.min(window.innerWidth * 0.9, 400);

    canvas.width = size;
    canvas.height = size;

    drawWheel();
  }

  window.addEventListener("resize", resizeCanvas);

  function drawWheel() {
    let center = canvas.width / 2;
    let radius = canvas.width * 0.42;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const sliceAngle = (2 * Math.PI) / prizes.length;

    for (let i = 0; i < prizes.length; i++) {
      let start = angle + i * sliceAngle;

      ctx.beginPath();
      ctx.moveTo(center, center);
      ctx.arc(center, center, radius, start, start + sliceAngle);

      ctx.fillStyle = "#FFD84D";
      ctx.fill();

      ctx.strokeStyle = "black";
      ctx.stroke();

      let mid = start + sliceAngle / 2;
      let iconR = radius * 0.65;

      let x = center + iconR * Math.cos(mid);
      let y = center + iconR * Math.sin(mid);

      let w = radius * 0.25;
      let h = radius * 0.32;

      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(mid + Math.PI / 2);
      ctx.drawImage(lixiIcon, -w/2, -h/2, w, h);
      ctx.restore();
    }

    /* M≈®I T√äN */
    ctx.fillStyle = "darkred";
    ctx.beginPath();
    ctx.moveTo(center - 12, 5);
    ctx.lineTo(center + 12, 5);
    ctx.lineTo(center, 45);
    ctx.fill();
  }

  function getPrize() {
    let total = prizes.reduce((s,p)=>s+p.weight,0);
    let rand = Math.random() * total;

    for (let p of prizes) {
      if (rand < p.weight) return p.name;
      rand -= p.weight;
    }
  }

  function showResult(prize) {
    finalReward = prize;
    rewardText.classList.remove("show");
    modal.style.display = "flex";
  }

  function launchFireworks() {
    const fw = document.getElementById("fireworks");
    fw.innerHTML = "";

    for (let i=0;i<20;i++){
      let spark = document.createElement("div");
      spark.className="firework";
      spark.style.left="50%";
      spark.style.top="50%";

      spark.style.setProperty("--x",(Math.random()-0.5)*250+"px");
      spark.style.setProperty("--y",(Math.random()-0.5)*200+"px");

      spark.style.background="hsl("+Math.random()*360+",100%,60%)";
      fw.appendChild(spark);
    }

    setTimeout(()=>fw.innerHTML="",900);
  }

  lixiImage.onclick = function(){
    lixiImage.src="images/lixi_open.png";
    rewardText.innerHTML="üéÅ "+finalReward;
    rewardText.classList.add("show");
    launchFireworks();
  };

  spinBtn.onclick = function(){
    if(spinning) return;
    spinning=true;

    let prize=getPrize();
    let time=0;

    let loop=setInterval(()=>{
      angle+=0.3;
      drawWheel();
      time+=50;

      if(time>3000){
        clearInterval(loop);
        spinning=false;
        showResult(prize);
      }
    },50);
  };

  closeBtn.onclick=function(){
    modal.style.display="none";
  };

  lixiIcon.onload=function(){
    resizeCanvas();
  };
</script>

</body>
</html>
